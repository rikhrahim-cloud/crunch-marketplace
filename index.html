<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUNCH - Yango For Side Hustles</title>
    
    <meta name="theme-color" content="#D4A747">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CRUNCH">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/logo-192.png">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif;
            background: #FAFAFA;
            color: #1a1a1a;
            -webkit-font-smoothing: antialiased;
        }
        .crunch-gradient {
            background: linear-gradient(135deg, #FF8A65 0%, #FF6B9D 50%, #E91E8C 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        .hero-image {
            width: 100%;
            height: 600px;
            object-fit: cover;
            transition: transform 0.6s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SUPABASE_URL = 'https://thgfclfgelfrcftycdna.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoZ2ZjbGZnZWxmcmNmdHljZG5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MDg3NTAsImV4cCI6MjA4NjQ4NDc1MH0.gOR4LFZPZ_xLxb0PpYOGr8DeAJwSURVNiWN-IFbD_9Q';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const cities = ['All Cities', 'YaoundÃ©', 'Douala', 'Bamenda', 'Bafoussam', 'Garoua', 'Maroua'];
        
        const neighborhoods = {
            'YaoundÃ©': ['Bastos', 'Melen', 'Essos', 'Mvan', 'Nlongkak', 'Biyem-Assi', 'Obili'],
            'Douala': ['Akwa', 'BonabÃ©ri', 'Bonanjo', 'Deido', 'Bonapriso', 'New Bell', 'BÃ©panda'],
            'Bafoussam': ['Centre Ville', 'Tougang', 'Famla'],
            'Bamenda': ['Commercial Avenue', 'Old Town', 'Nkwen', 'Mile 3'],
            'Garoua': ['Centre Ville', 'Plateau', 'DoualarÃ©'],
            'Maroua': ['Domayo', 'Centre Ville', 'Djarengol']
        };

        const translations = {
            en: {
                browse: "Browse", about: "About", contact: "Contact", signIn: "Sign In", joinNow: "Join Now", logout: "Logout",
                tagline: "Yango For Side Hustles", heroSubtitle: "Find Trusted Service Providers in Cameroon",
                searchPlaceholder: "Search services...", bookNow: "Book Now", addService: "Add Service",
                allCities: "All Cities", allNeighborhoods: "All Neighborhoods", perHour: "per hour"
            },
            fr: {
                browse: "Parcurir", about: "Ã€ Propos", contact: "Contact", signIn: "Se Connecter", joinNow: "Rejoindre", logout: "DÃ©connexion",
                tagline: "Yango Pour Les Petits Boulots", heroSubtitle: "Trouvez des Prestataires Fiables au Cameroun",
                searchPlaceholder: "Rechercher...", bookNow: "RÃ©server", addService: "Ajouter Service",
                allCities: "Toutes les Villes", allNeighborhoods: "Tous les Quartiers", perHour: "par heure"
            }
        };

        function CrunchApp() {
            const [language, setLanguage] = useState('en');
            const [currentView, setCurrentView] = useState('home');
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [providers, setProviders] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCity, setSelectedCity] = useState('All Cities');
            const [selectedNeighborhood, setSelectedNeighborhood] = useState('All Neighborhoods');
            const [showProfileModal, setShowProfileModal] = useState(false);
            const t = translations[language];

            useEffect(() => { loadProviders(); }, []);

            const loadProviders = async () => {
                const { data } = await supabase.from('providers').select('*, profiles(*)').eq('available', true);
                if (data) setProviders(data.map(p => ({
                    id: p.id, name: p.profiles?.full_name, service: p.service, category: p.category,
                    city: p.city, neighborhood: p.neighborhood, hourlyRate: p.hourly_rate,
                    description: p.description, image: p.images?.[0] || 'https://via.placeholder.com/400'
                })));
            };

            const filteredProviders = providers.filter(provider => {
                const matchesSearch = provider.name.toLowerCase().includes(searchTerm.toLowerCase()) || provider.service.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCity = selectedCity === 'All Cities' || provider.city === selectedCity;
                const matchesNeighborhood = selectedNeighborhood === 'All Neighborhoods' || 
                                           selectedNeighborhood === t.allNeighborhoods ||
                                           provider.neighborhood === selectedNeighborhood;
                return matchesSearch && matchesCity && matchesNeighborhood;
            });

            return (
                <div className="min-h-screen">
                    <header className="fixed top-0 left-0 right-0 bg-white z-50 border-b h-20 px-6 flex justify-between items-center shadow-sm">
                        <div className="flex items-center gap-3 font-bold text-2xl cursor-pointer" onClick={() => setCurrentView('home')}>
                            <img src="logo.png" className="h-10 w-10" alt="logo" /> CRUNCH
                        </div>
                        <nav className="hidden md:flex gap-8 text-sm items-center">
                            <button onClick={() => setCurrentView('home')}>{t.browse}</button>
                            <button onClick={() => setCurrentView('about')}>{t.about}</button>
                            <button onClick={() => setLanguage(language === 'en' ? 'fr' : 'en')} className="bg-gray-100 px-3 py-1 rounded-full font-medium">
                                {language === 'en' ? 'ðŸ‡«ðŸ‡· FR' : 'ðŸ‡¬ðŸ‡§ EN'}
                            </button>
                        </nav>
                        <div className="flex gap-4">
                            {!isLoggedIn ? (
                                <button className="bg-black text-white px-6 py-2 rounded-md text-sm">{t.joinNow}</button>
                            ) : (
                                <button onClick={() => setIsLoggedIn(false)} className="text-red-600 text-sm">{t.logout}</button>
                            )}
                        </div>
                    </header>

                    <div className="pt-20">
                        {currentView === 'home' && (
                            <>
                                <section className="py-24 px-6 max-w-7xl mx-auto grid md:grid-cols-2 gap-16 items-center">
                                    <div>
                                        <h1 className="text-6xl font-bold mb-6">Yango For <span className="crunch-gradient">Side Hustles</span></h1>
                                        <p className="text-xl text-gray-600 mb-12">{t.heroSubtitle}</p>
                                        <input 
                                            type="text" 
                                            placeholder={t.searchPlaceholder} 
                                            className="w-full p-4 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-pink-500 outline-none"
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                    </div>
                                    <div className="hero-image-container"><img src="hero-image.jpg" className="hero-image" alt="Hero" /></div>
                                </section>

                                <section className="py-12 px-6 bg-gray-50 border-y">
                                    <div className="max-w-7xl mx-auto flex flex-wrap gap-4">
                                        <select 
                                            className="p-3 border rounded-lg bg-white shadow-sm"
                                            value={selectedCity}
                                            onChange={(e) => { setSelectedCity(e.target.value); setSelectedNeighborhood('All Neighborhoods'); }}
                                        >
                                            <option value="All Cities">{t.allCities}</option>
                                            {cities.slice(1).map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                        
                                        {selectedCity !== 'All Cities' && neighborhoods[selectedCity] && (
                                            <select 
                                                className="p-3 border rounded-lg bg-white shadow-sm"
                                                value={selectedNeighborhood}
                                                onChange={(e) => setSelectedNeighborhood(e.target.value)}
                                            >
                                                <option>{t.allNeighborhoods}</option>
                                                {neighborhoods[selectedCity].map(n => <option key={n} value={n}>{n}</option>)}
                                            </select>
                                        )}
                                    </div>
                                </section>

                                <section className="py-16 px-6 max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
                                    {filteredProviders.map(p => (
                                        <div key={p.id} className="border rounded-xl overflow-hidden bg-white shadow-sm hover:shadow-xl transition-all duration-300">
                                            <img src={p.image} className="w-full h-56 object-cover" alt={p.name} />
                                            <div className="p-5">
                                                <h3 className="font-bold text-lg">{p.name}</h3>
                                                <p className="text-sm text-gray-500 mb-4">{p.service} â€¢ {p.neighborhood || p.city}</p>
                                                <div className="flex justify-between items-center mt-4 pt-4 border-t">
                                                    <span className="font-bold text-xl">{p.hourlyRate} <span className="text-xs text-gray-400 font-normal">CFA</span></span>
                                                    <button className="bg-black text-white px-5 py-2 rounded-lg text-sm font-medium hover:bg-gray-800 transition">
                                                        {t.bookNow}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </section>
                            </>
                        )}
                    </div>

                    {/* Golden + Button - Top Left */}
                    {isLoggedIn && (
                        <button
                            onClick={() => setShowProfileModal(true)}
                            className="fixed top-24 left-8 w-14 h-14 hover:w-16 hover:h-16 rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 z-50 group"
                            style={{background: '#D4A747'}}
                        >
                            <svg className="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M12 4v16m8-8H4" />
                            </svg>
                            <span className="absolute left-16 top-1/2 transform -translate-y-1/2 bg-gray-900 text-white text-xs px-3 py-1.5 rounded-md opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                                {t.addService}
                            </span>
                        </button>
                    )}
                </div>
            );
        }

        ReactDOM.render(<CrunchApp />, document.getElementById('root'));

        // PWA Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW error:', err));
            });
        }
    </script>
</body>
</html>
